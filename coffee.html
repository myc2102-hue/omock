<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì»¤í”¼ìš”ì •ì°°ìŠ¤ - Apple Style</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        /* ì• í”Œ ìŠ¤íƒ€ì¼ ì‹œìŠ¤í…œ í°íŠ¸ ë° ì»¬ëŸ¬ */
        :root { 
            --primary: #1d1d1f; /* Apple Black */
            --accent: #0071e3;  /* Apple Blue */
            --ice: #64d2ff; 
            --hot: #ff3b30; 
            --shot: #34c759;
            --bg: #f5f5f7;      /* Apple Gray */
            --card: rgba(255, 255, 255, 0.8);
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro KR", "SF Pro Text", "Helvetica Neue", Arial, sans-serif; 
            background: var(--bg); margin: 0; padding: 20px; color: var(--primary); 
            -webkit-font-smoothing: antialiased;
        }

        .container { 
            max-width: 500px; margin: 0 auto; padding: 30px 20px; 
            background: var(--card); backdrop-filter: blur(20px); 
            border-radius: 28px; box-shadow: 0 8px 32px rgba(0,0,0,0.05); 
        }
        
        h1 { text-align: center; font-size: 24px; font-weight: 700; letter-spacing: -0.5px; margin: 0 0 20px 0; }

        /* ì»¤ìŠ¤í…€ ëª¨ë‹¬ (ì• í”Œ ìŠ¤íƒ€ì¼ ì•Œë¦¼ì°½) */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); backdrop-filter: blur(5px); display: none; align-items: center; justify-content: center; z-index: 9999; }
        .modal-box { background: white; padding: 24px; border-radius: 20px; text-align: center; width: 80%; max-width: 300px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        .modal-box h2 { font-size: 18px; margin: 0 0 8px 0; }
        .modal-box p { font-size: 14px; margin-bottom: 20px; color: #86868b; }
        .modal-box input { width: 100%; padding: 12px; border: 1px solid #d2d2d7; border-radius: 12px; font-size: 16px; text-align: center; outline: none; margin-bottom: 16px; transition: all 0.3s; }
        .modal-box input:focus { border-color: var(--accent); }
        
        .modal-btns { display: flex; gap: 8px; }
        .modal-btns button { flex: 1; padding: 12px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; font-size: 15px; }
        .btn-confirm { background: var(--accent); color: white; }
        .btn-cancel { background: #e8e8ed; color: var(--primary); }

        /* íƒ­ ë° ìƒë‹¨ ì •ë³´ */
        .user-info { text-align: center; font-size: 13px; margin-bottom: 20px; color: #86868b; }
        .user-info span { color: var(--accent); font-weight: 600; cursor: pointer; }

        .tabs { display: flex; background: #e8e8ed; padding: 4px; border-radius: 14px; margin-bottom: 24px; }
        .tab { flex: 1; padding: 10px; text-align: center; border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease; color: #86868b; }
        .tab.active { background: white; color: var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }

        .timer-banner { background: var(--primary); color: #fff; padding: 16px; border-radius: 20px; text-align: center; margin-bottom: 24px; }
        #time-left { font-size: 20px; font-weight: 700; color: #fff; font-variant-numeric: tabular-nums; }
        #notice-text { font-size: 12px; opacity: 0.6; margin-top: 4px; }

        /* ë©”ë‰´ ì„¹ì…˜ */
        .menu-item { background: #fff; border-radius: 20px; padding: 20px; margin-bottom: 16px; border: 1px solid #f0f0f2; }
        .menu-name { font-weight: 600; font-size: 17px; display: block; text-align: center; margin-bottom: 16px; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        button:not(.btn-count, .modal-btns button) { 
            padding: 14px; border: none; border-radius: 14px; cursor: pointer; 
            font-weight: 600; font-size: 14px; transition: transform 0.1s active, opacity 0.2s; 
        }
        button:active { transform: scale(0.97); }
        .btn-ice { background: #f2f7ff; color: var(--accent); }
        .btn-hot { background: #fff2f2; color: var(--hot); }
        .btn-shot { border: 1.5px dashed #34c759 !important; background: #f2fff5; }
        
        button:disabled { background: #f5f5f7 !important; color: #d2d2d7 !important; cursor: not-allowed; }
        
        #etc-name { 
            width: 100%; padding: 14px; border: 1px solid #d2d2d7; border-radius: 14px; 
            margin-bottom: 12px; box-sizing: border-box; font-size: 15px; background: #fff;
        }

        /* ìš”ì•½ ì„¹ì…˜ */
        .order-summary { margin-top: 32px; background: #fff; border-radius: 24px; padding: 20px; border: 1px solid #f0f0f2; }
        .group-item { padding: 14px 0; border-bottom: 1px solid #f5f5f7; }
        .group-item:last-child { border: none; }
        .group-header { display: flex; justify-content: space-between; font-weight: 600; font-size: 16px; }
        .group-names { font-size: 13px; color: #86868b; margin-top: 6px; }
        
        .btn-count { 
            width: 28px; height: 28px; border-radius: 50%; border: none; 
            background: #f5f5f7; color: var(--primary); font-weight: 700; cursor: pointer; 
        }
        
        .btn-my-clear { width: 100%; margin-top: 20px; padding: 16px; background: var(--accent); color: white; border: none; border-radius: 16px; font-weight: 600; font-size: 15px; }
        .btn-all-clear { width: 100%; margin-top: 10px; padding: 10px; background: transparent; color: #86868b; border: none; font-size: 12px; }
    </style>
</head>
<body>

<div id="modal-login" class="modal-overlay" style="display: flex;">
    <div class="modal-box">
        <h2>â˜• ëˆ„êµ¬ì‹ ê°€ìš”?</h2>
        <p>ì£¼ë¬¸ í™•ì¸ì„ ìœ„í•´ ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
        <input type="text" id="user-input" placeholder="ì´ë¦„ ì…ë ¥" onkeypress="if(event.keyCode==13) login()">
        <button class="btn-confirm" style="width:100%" onclick="login()">ì…ì¥í•˜ê¸°</button>
    </div>
</div>

<div id="modal-confirm" class="modal-overlay">
    <div class="modal-box">
        <h2>ğŸ›’ ì£¼ë¬¸ í™•ì¸</h2>
        <p id="confirm-msg"></p>
        <div class="modal-btns">
            <button class="btn-cancel" onclick="closeConfirm()">ì·¨ì†Œ</button>
            <button class="btn-confirm" id="final-order-btn">ì£¼ë¬¸í•˜ê¸°</button>
        </div>
    </div>
</div>

<div class="container">
    <h1>ì»¤í”¼ìš”ì •ì°°ìŠ¤</h1>
    <div id="user-display" class="user-info" style="display:none;">
        <b id="current-user"></b> ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤! <span onclick="location.reload()">(ì´ë¦„ë³€ê²½)</span>
    </div>

    <div class="tabs">
        <div id="tab-morning" class="tab" onclick="switchTab('morning')">ì•„ì¹¨ìš©</div>
        <div id="tab-daily" class="tab" onclick="switchTab('daily')">ì£¼ê°„ìš©</div>
    </div>

    <div class="timer-banner">
        <span id="timer-label" style="font-size: 12px; opacity: 0.8; display: block; margin-bottom: 4px;">ì—°ê²° ì¤‘...</span>
        <span id="time-left">00:00:00</span>
        <div id="notice-text"></div>
    </div>

    <div id="menu-container">
        <div class="menu-item">
            <span class="menu-name">ì•„ë©”ë¦¬ì¹´ë…¸</span>
            <div class="btn-grid">
                <button class="btn-ice order-btn" onclick="openConfirm('ì•„ë©”ë¦¬ì¹´ë…¸ (Ice)')">Ice</button>
                <button class="btn-hot order-btn" onclick="openConfirm('ì•„ë©”ë¦¬ì¹´ë…¸ (Hot)')">Hot</button>
                <button class="btn-ice btn-shot order-btn" onclick="openConfirm('ì•„ë©”ë¦¬ì¹´ë…¸ (Ice) +ìƒ·')">Ice +Shot</button>
                <button class="btn-hot btn-shot order-btn" onclick="openConfirm('ì•„ë©”ë¦¬ì¹´ë…¸ (Hot) +ìƒ·')">Hot +Shot</button>
            </div>
        </div>
        <div class="menu-item">
            <span class="menu-name">ë¼ë–¼</span>
            <div class="btn-grid">
                <button class="btn-ice order-btn" onclick="openConfirm('ë¼ë–¼ (Ice)')">Ice</button>
                <button class="btn-hot order-btn" onclick="openConfirm('ë¼ë–¼ (Hot)')">Hot</button>
                <button class="btn-ice btn-shot order-btn" onclick="openConfirm('ë¼ë–¼ (Ice) +ìƒ·')">Ice +Shot</button>
                <button class="btn-hot btn-shot order-btn" onclick="openConfirm('ë¼ë–¼ (Hot) +ìƒ·')">Hot +Shot</button>
            </div>
        </div>
        <div class="menu-item">
            <span class="menu-name">ê¸°íƒ€ ë©”ë‰´ ì§ì ‘ ì…ë ¥</span>
            <input type="text" id="etc-name" placeholder="ë©”ë‰´ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
            <div class="btn-grid">
                <button class="btn-ice order-btn" onclick="addEtcConfirm('Ice')">Ice</button>
                <button class="btn-hot order-btn" onclick="addEtcConfirm('Hot')">Hot</button>
                <button class="btn-ice btn-shot order-btn" onclick="addEtcConfirm('Ice +ìƒ·')">Ice +Shot</button>
                <button class="btn-hot btn-shot order-btn" onclick="addEtcConfirm('Hot +ìƒ·')">Hot +Shot</button>
            </div>
        </div>
    </div>

    <div class="order-summary">
        <h2 style="font-size:18px; font-weight: 700; margin: 0 0 12px 0;">ì£¼ë¬¸ ìš”ì•½ í˜„í™© ğŸ›’</h2>
        <div id="grouped-list"></div>
        <div style="text-align:right; font-weight:700; margin-top:20px; padding-top:12px; border-top:1px solid #f5f5f7; font-size:18px;">
            ì´ ìˆ˜ëŸ‰: <span id="total-count">0</span>ê°œ
        </div>
        <button class="btn-my-clear" onclick="clearMyOrders()">ë‚´ê°€ í•œ ì£¼ë¬¸ë§Œ ì™ì™ ì´ˆê¸°í™”</button>
        <button class="btn-all-clear" onclick="clearAllOrders()">ì „ì²´ ë°ì´í„° ì´ˆê¸°í™”</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBSxM3W_RkCt8poqQJxVhIgYMPqLuZgT6Y",
        authDomain: "menusame-6a326.firebaseapp.com",
        databaseURL: "https://menusame-6a326-default-rtdb.firebaseio.com",
        projectId: "menusame-6a326",
        storageBucket: "menusame-6a326.firebasestorage.app",
        messagingSenderId: "822750462446",
        appId: "1:822750462446:web:1cc67bd3f2b49e52670eff"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let userName = "";
    let currentCategory = 'morning';
    const TIMES = {
        morning: { open: 7*3600, close: 7*3600+58*60, label: "ì•„ì¹¨ (07:00~07:58)" },
        daily: { open: 9*3600, close: 18*3600, label: "ì£¼ê°„ (09:00~18:00)" }
    };

    function login() {
        const input = document.getElementById('user-input').value.trim();
        if(!input) return;
        userName = input;
        document.getElementById('modal-login').style.display = 'none';
        document.getElementById('user-display').style.display = 'block';
        document.getElementById('current-user').innerText = userName;
        updateTimer();
    }

    function openConfirm(menu) {
        if(!userName) return;
        document.getElementById('confirm-msg').innerHTML = `<b>${userName}</b>ë‹˜,<br>[${menu}]ì„(ë¥¼) ì£¼ë¬¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
        document.getElementById('modal-confirm').style.display = 'flex';
        document.getElementById('final-order-btn').onclick = function() {
            addOrder(menu);
            closeConfirm();
        };
    }

    function addEtcConfirm(suffix) {
        const input = document.getElementById('etc-name');
        const menuName = input.value.trim();
        if(!menuName) return alert("ë©”ë‰´ëª…ì„ ì…ë ¥í•˜ì„¸ìš”");
        openConfirm(`${menuName} (${suffix})`);
        input.value = "";
    }

    function closeConfirm() { document.getElementById('modal-confirm').style.display = 'none'; }

    function getKSTSeconds() {
        const now = new Date();
        const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
        const kr = new Date(utc + (9 * 3600000));
        return kr.getHours() * 3600 + kr.getMinutes() * 60 + kr.getSeconds();
    }

    function switchTab(type) {
        currentCategory = type;
        document.getElementById('tab-morning').className = (type === 'morning' ? 'tab active' : 'tab');
        document.getElementById('tab-daily').className = (type === 'daily' ? 'tab active' : 'tab');
        updateTimer();
    }

    function updateTimer() {
        const curSec = getKSTSeconds();
        const config = TIMES[currentCategory];
        const timerEl = document.getElementById('time-left');
        const labelEl = document.getElementById('timer-label');
        const btns = document.querySelectorAll('.order-btn');
        document.getElementById('notice-text').innerText = `ìš´ì˜ì‹œê°„: ${config.label}`;

        const isOpen = curSec >= config.open && curSec < config.close;
        if (isOpen) {
            labelEl.innerText = "ì˜ì—… ì¤‘";
            const diff = config.close - curSec;
            timerEl.innerText = `${Math.floor(diff/3600).toString().padStart(2,'0')}:${Math.floor((diff%3600)/60).toString().padStart(2,'0')}:${(diff%60).toString().padStart(2,'0')}`;
        } else {
            labelEl.innerText = "ì˜ì—… ì¢…ë£Œ";
            timerEl.innerText = "00:00:00";
        }
        btns.forEach(b => b.disabled = !isOpen);
    }

    function addOrder(menu) {
        const prefix = currentCategory === 'morning' ? "ì•„ì¹¨" : "ì£¼ê°„";
        const orderKey = `${userName}|${prefix}_${menu}`;
        db.ref('orders/' + orderKey).transaction(cv => (cv || 0) + 1);
    }

    function clearMyOrders() {
        if(confirm("ì •ë§ ë³¸ì¸ì˜ ì£¼ë¬¸ì„ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            db.ref('orders').once('value', (snapshot) => {
                const orders = snapshot.val();
                if(!orders) return;
                Object.keys(orders).forEach(key => {
                    if(key.startsWith(userName + "|")) db.ref('orders/' + key).remove();
                });
            });
        }
    }

    function clearAllOrders() { if(confirm("ì „ì²´ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) db.ref('orders').remove(); }

    db.ref('orders').on('value', (snapshot) => {
        const rawOrders = snapshot.val() || {};
        const listEl = document.getElementById('grouped-list');
        const totalEl = document.getElementById('total-count');
        listEl.innerHTML = "";
        let totalQty = 0; let grouped = {};
        Object.keys(rawOrders).forEach(key => {
            const [name, rawMenu] = key.split('|');
            const menu = rawMenu.replace('ì•„ì¹¨_', '').replace('ì£¼ê°„_', '');
            const count = rawOrders[key];
            if(!grouped[menu]) grouped[menu] = { count: 0, names: [] };
            grouped[menu].count += count;
            grouped[menu].names.push(`${name}${count > 1 ? '('+count+')' : ''}`);
            totalQty += count;
        });
        Object.keys(grouped).sort().forEach(menu => {
            const item = grouped[menu];
            const div = document.createElement('div');
            div.className = 'group-item';
            div.innerHTML = `<div class="group-header"><span>${menu}</span><span style="color:var(--accent)">${item.count}ì”</span></div><div class="group-names">${item.names.join(', ')}</div>`;
            listEl.appendChild(div);
        });
        totalEl.innerText = totalQty;
    });

    setInterval(updateTimer, 1000);
    window.onload = () => {
        const s = getKSTSeconds();
        if (s >= TIMES.morning.open && s < TIMES.morning.close) switchTab('morning');
        else switchTab('daily');
    };
</script>
</body>
</html>