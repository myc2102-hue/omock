<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì»¤í”¼ìš”ì •ì°°ìŠ¤ - ë§ì¶¤ ì£¼ë¬¸</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #6f4e37; --ice: #007bff; --hot: #dc3545; --bg: #fdfaf7; --accent: #e67e22; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; }
        .container { max-width: 480px; margin: 0 auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
        
        h1 { text-align: center; color: var(--primary); margin-bottom: 20px; }
        
        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab { flex: 1; padding: 12px; text-align: center; background: #eee; border-radius: 12px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .tab.active { background: var(--primary); color: white; }

        /* íƒ€ì´ë¨¸ ë°°ë„ˆ */
        .timer-banner { background: #333; color: #fff; padding: 15px; border-radius: 12px; text-align: center; margin-bottom: 20px; }
        #time-left { font-size: 1.4rem; font-weight: 800; color: #f1c40f; display: block; }
        .notice-text { font-size: 0.8rem; color: #ccc; margin-top: 5px; }

        .menu-section { display: none; }
        .menu-section.active { display: block; }

        .menu-item { border-bottom: 1px solid #f0f0f0; padding: 18px 0; }
        .menu-name { font-size: 1.1rem; font-weight: 700; margin-bottom: 12px; display: block; }
        .btn-group { display: flex; gap: 10px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; transition: 0.2s; font-size: 1rem; }
        
        .btn-ice { background: #eef6ff; color: var(--ice); border: 1px solid #cce3ff; }
        .btn-hot { background: #fff5f5; color: var(--hot); border: 1px solid #ffe3e3; }
        button:disabled { background: #eee !important; color: #aaa !important; cursor: not-allowed; }
        
        input[type="text"] { width: 100%; padding: 12px; margin-bottom: 12px; border: 2px solid #eee; border-radius: 12px; box-sizing: border-box; outline: none; }

        .order-summary { margin-top: 30px; background: #fff; padding: 20px; border-radius: 15px; border: 2px solid var(--primary); }
        .summary-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .btn-reset { flex: none; width: auto; padding: 6px 12px; font-size: 0.8rem; background: #f8f9fa; border: 1px solid #ddd; }

        .order-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px dashed #eee; }
        .count-controls { display: flex; align-items: center; gap: 10px; }
        .btn-count { width: 28px; height: 28px; border-radius: 50%; background: #eee; border: 1px solid #ccc; }
        .total-section { text-align: right; font-size: 1.25rem; color: var(--primary); font-weight: 800; margin-top: 15px; padding-top: 10px; border-top: 2px solid #eee; }
    </style>
</head>
<body>

<div class="container">
    <h1>â˜• ì°°ìŠ¤ëŠ”ì»¤í”¼ìš”ì •</h1>
    
    <div class="tabs">
        <div class="tab active" onclick="switchTab('morning')">ì•„ì¹¨ìš©</div>
        <div class="tab" onclick="switchTab('daily')">ì¼ìƒìš©</div>
    </div>

    <div class="timer-banner">
        <span id="timer-label">ë¡œë”© ì¤‘...</span>
        <span id="time-left">00:00:00</span>
        <div id="notice-text" class="notice-text">ìš´ì˜ì‹œê°„ í™•ì¸ ì¤‘</div>
    </div>

    <div id="morning-section" class="menu-section active">
        <div class="menu-item">
            <span class="menu-name">ì•„ë©”ë¦¬ì¹´ë…¸ (ì•„ì¹¨)</span>
            <div class="btn-group">
                <button class="btn-ice order-btn" onclick="handleOrder('ì•„ì¹¨-ì•„ë©”ë¦¬ì¹´ë…¸ (Ice)', 1)">Ice</button>
                <button class="btn-hot order-btn" onclick="handleOrder('ì•„ì¹¨-ì•„ë©”ë¦¬ì¹´ë…¸ (Hot)', 1)">Hot</button>
            </div>
        </div>
        <div class="menu-item">
            <span class="menu-name">ë¼ë–¼ (ì•„ì¹¨)</span>
            <div class="btn-group">
                <button class="btn-ice order-btn" onclick="handleOrder('ì•„ì¹¨-ë¼ë–¼ (Ice)', 1)">Ice</button>
                <button class="btn-hot order-btn" onclick="handleOrder('ì•„ì¹¨-ë¼ë–¼ (Hot)', 1)">Hot</button>
            </div>
        </div>
    </div>

    <div id="daily-section" class="menu-section">
        <div class="menu-item">
            <span class="menu-name">ì¼ìƒ ë©”ë‰´ ì…ë ¥</span>
            <input type="text" id="etc-name" placeholder="ë©”ë‰´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì•„ì´ìŠ¤í‹°)">
            <div class="btn-group">
                <button class="btn-ice order-btn" onclick="updateEtcOrder('Ice')">Ice</button>
                <button class="btn-hot order-btn" onclick="updateEtcOrder('Hot')">Hot</button>
            </div>
        </div>
        <p style="font-size: 0.8rem; color: #888; text-align: center;">ì¼ìƒìš©ì€ ì˜¤ì „ 9ì‹œ ~ ì˜¤í›„ 6ì‹œê¹Œì§€ ì£¼ë¬¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
    </div>

    <div class="order-summary">
        <div class="summary-header">
            <h2>ì˜¤ëŠ˜ì˜ ì£¼ë¬¸ ğŸ›’</h2>
            <button class="btn-reset" onclick="clearAllOrders()">ì´ˆê¸°í™”</button>
        </div>
        <ul id="order-list" style="list-style:none; padding:0;"></ul>
        <div class="total-section">ì´ ìˆ˜ëŸ‰: <span id="total-count">0</span>ê°œ</div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBSxM3W_RkCt8poqQJxVhIgYMPqLuZgT6Y",
        authDomain: "menusame-6a326.firebaseapp.com",
        databaseURL: "https://menusame-6a326-default-rtdb.firebaseio.com",
        projectId: "menusame-6a326",
        storageBucket: "menusame-6a326.firebasestorage.app",
        messagingSenderId: "822750462446",
        appId: "1:822750462446:web:1cc67bd3f2b49e52670eff"
    };
    firebase.initializeApp(firebaseConfig);
    const orderRef = firebase.database().ref('orders');

    let currentCategory = 'morning';

    function switchTab(type) {
        currentCategory = type;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.menu-section').forEach(s => s.classList.remove('active'));
        
        if(type === 'morning') {
            document.querySelectorAll('.tab')[0].classList.add('active');
            document.getElementById('morning-section').classList.add('active');
        } else {
            document.querySelectorAll('.tab')[1].classList.add('active');
            document.getElementById('daily-section').classList.add('active');
        }
        updateTimer();
    }

    function getStatus() {
        const now = new Date();
        const cur = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
        
        let config = { open: 7*3600, close: 7*3600+58*60, label: "ì•„ì¹¨ìš© (07:00~07:58)" }; // ì•„ì¹¨ìš©
        if (currentCategory === 'daily') {
            config = { open: 9*3600, close: 18*3600, label: "ì¼ìƒìš© (09:00~18:00)" }; // ì¼ìƒìš©
        }

        if (cur < config.open) return { state: 'BEFORE', diff: config.open - cur, config };
        if (cur < config.close) return { state: 'OPEN', diff: config.close - cur, config };
        return { state: 'CLOSED', diff: 0, config };
    }

    function updateTimer() {
        const s = getStatus();
        const timerEl = document.getElementById('time-left');
        const labelEl = document.getElementById('timer-label');
        const noticeEl = document.getElementById('notice-text');
        const btns = document.querySelectorAll('.order-btn');

        noticeEl.innerText = `ìš´ì˜ì‹œê°„: ${s.config.label}`;

        if (s.state === 'BEFORE') {
            labelEl.innerText = "ì£¼ë¬¸ ì‹œì‘ê¹Œì§€";
            btns.forEach(b => b.disabled = true);
        } else if (s.state === 'OPEN') {
            labelEl.innerText = "ì£¼ë¬¸ ë§ˆê°ê¹Œì§€";
            btns.forEach(b => b.disabled = false);
        } else {
            labelEl.innerText = "ì£¼ë¬¸ ì¢…ë£Œ";
            timerEl.innerText = "00:00:00";
            btns.forEach(b => b.disabled = true);
            return;
        }

        const h = Math.floor(s.diff/3600).toString().padStart(2,'0');
        const m = Math.floor((s.diff%3600)/60).toString().padStart(2,'0');
        const sec = (s.diff%60).toString().padStart(2,'0');
        timerEl.innerText = `${h}:${m}:${sec}`;
    }

    setInterval(updateTimer, 1000);

    function handleOrder(key, amt) {
        if (getStatus().state !== 'OPEN') return alert("í˜„ì¬ ì£¼ë¬¸ ê°€ëŠ¥ ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤.");
        orderRef.child(key).transaction(cv => {
            const nv = (cv || 0) + amt;
            return nv <= 0 ? null : nv;
        });
    }

    function updateEtcOrder(opt) {
        const input = document.getElementById('etc-name');
        const name = input.value.trim();
        if(!name) return alert("ë©”ë‰´ëª…ì„ ì…ë ¥í•˜ì„¸ìš”");
        handleOrder(`ì¼ìƒ-${name} (${opt})`, 1);
        input.value = "";
    }

    function clearAllOrders() {
        if(confirm("ëª¨ë“  ì£¼ë¬¸ì„ ì´ˆê¸°í™”í• ê¹Œìš”?")) orderRef.remove();
    }

    orderRef.on('value', (snapshot) => {
        const orders = snapshot.val() || {};
        const listEl = document.getElementById('order-list');
        const totalEl = document.getElementById('total-count');
        listEl.innerHTML = "";
        let total = 0;

        Object.keys(orders).forEach(key => {
            const count = orders[key];
            const li = document.createElement('li');
            li.className = 'order-item';
            li.innerHTML = `<span>${key}</span><div class="count-controls">
                <button class="btn-count" onclick="handleOrder('${key}', -1)">-</button>
                <span class="item-count">${count}</span>
                <button class="btn-count" onclick="handleOrder('${key}', 1)">+</button>
            </div>`;
            listEl.appendChild(li);
            total += count;
        });
        totalEl.innerText = total;
    });
</script>
</body>
</html>