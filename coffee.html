<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïª§ÌîºÏöîÏ†ïÏ∞∞Ïä§ - Îã§Ïù¥Î†âÌä∏ Ï£ºÎ¨∏</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #6f4e37; --ice: #007bff; --hot: #dc3545; --bg: #fdfaf7; --shot: #2ecc71; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; padding: 15px; color: #333; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
        h1 { text-align: center; color: var(--primary); margin-bottom: 20px; }
        
        .tabs { display: flex; gap: 8px; margin-bottom: 20px; }
        .tab { flex: 1; padding: 12px; text-align: center; background: #eee; border-radius: 12px; cursor: pointer; font-weight: bold; }
        .tab.active { background: var(--primary); color: white; }

        .timer-banner { background: #333; color: #fff; padding: 15px; border-radius: 12px; text-align: center; margin-bottom: 20px; }
        #time-left { font-size: 1.5rem; font-weight: 800; color: #f1c40f; display: block; }
        
        .menu-item { border-bottom: 1px solid #f5f5f5; padding: 20px 0; }
        .menu-name { font-weight: bold; font-size: 1.1rem; display: block; margin-bottom: 15px; text-align: center; }

        /* 4Í∞ú Î≤ÑÌäº Í∑∏Î¶¨Îìú Î∞∞Ïπò */
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { padding: 12px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 0.9rem; transition: 0.2s; }
        
        .btn-ice { background: #eef6ff; color: var(--ice); border: 1px solid #cce3ff; }
        .btn-hot { background: #fff5f5; color: var(--hot); border: 1px solid #ffe3e3; }
        .btn-shot { border: 1px dashed var(--shot); position: relative; }
        .btn-shot::after { content: " +Shot"; font-size: 0.7rem; vertical-align: top; }
        
        button:disabled { background: #f0f0f0 !important; color: #ccc !important; cursor: not-allowed; border: none; }
        
        .order-summary { margin-top: 30px; border: 2px solid var(--primary); padding: 15px; border-radius: 15px; }
        .order-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px dashed #eee; gap: 10px; }
        .btn-count { width: 32px; height: 32px; border-radius: 50%; border: 1px solid #dee2e6; cursor: pointer; background: #fff; }
    </style>
</head>
<body>
<div class="container">
    <h1>‚òï Ï∞∞Ïä§ÎäîÏª§ÌîºÏöîÏ†ï</h1>
    <div class="tabs">
        <div id="tab-morning" class="tab" onclick="switchTab('morning')">ÏïÑÏπ®Ïö©</div>
        <div id="tab-daily" class="tab" onclick="switchTab('daily')">Ï£ºÍ∞ÑÏö©</div>
    </div>
    <div class="timer-banner">
        <span id="timer-label">Î°úÎî© Ï§ë...</span>
        <span id="time-left">00:00:00</span>
        <div id="notice-text" style="font-size:0.75rem; color:#ccc; margin-top:5px;"></div>
    </div>

    <div id="menu-container">
        <div class="menu-item">
            <span class="menu-name">ÏïÑÎ©îÎ¶¨Ïπ¥ÎÖ∏</span>
            <div class="btn-grid">
                <button class="btn-ice order-btn" onclick="addOrder('ÏïÑÎ©îÎ¶¨Ïπ¥ÎÖ∏ (Ice)')">Ice</button>
                <button class="btn-hot order-btn" onclick="addOrder('ÏïÑÎ©îÎ¶¨Ïπ¥ÎÖ∏ (Hot)')">Hot</button>
                <button class="btn-ice btn-shot order-btn" onclick="addOrder('ÏïÑÎ©îÎ¶¨Ïπ¥ÎÖ∏ (Ice) +ÏÉ∑Ï∂îÍ∞Ä')">Ice</button>
                <button class="btn-hot btn-shot order-btn" onclick="addOrder('ÏïÑÎ©îÎ¶¨Ïπ¥ÎÖ∏ (Hot) +ÏÉ∑Ï∂îÍ∞Ä')">Hot</button>
            </div>
        </div>
        <div class="menu-item">
            <span class="menu-name">ÎùºÎñº</span>
            <div class="btn-grid">
                <button class="btn-ice order-btn" onclick="addOrder('ÎùºÎñº (Ice)')">Ice</button>
                <button class="btn-hot order-btn" onclick="addOrder('ÎùºÎñº (Hot)')">Hot</button>
                <button class="btn-ice btn-shot order-btn" onclick="addOrder('ÎùºÎñº (Ice) +ÏÉ∑Ï∂îÍ∞Ä')">Ice</button>
                <button class="btn-hot btn-shot order-btn" onclick="addOrder('ÎùºÎñº (Hot) +ÏÉ∑Ï∂îÍ∞Ä')">Hot</button>
            </div>
        </div>
        <div class="menu-item">
            <span class="menu-name">Í∏∞ÌÉÄ Î©îÎâ¥ ÏßÅÏ†ë ÏûÖÎ†•</span>
            <input type="text" id="etc-name" style="width:100%; padding:12px; margin-bottom:10px; border:1px solid #ddd; border-radius:10px; box-sizing:border-box;" placeholder="Î©îÎâ¥Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
            <div class="btn-grid">
                <button class="btn-ice order-btn" onclick="addEtcOrder('Ice')">Ice</button>
                <button class="btn-hot order-btn" onclick="addEtcOrder('Hot')">Hot</button>
                <button class="btn-ice btn-shot order-btn" onclick="addEtcOrder('Ice +ÏÉ∑Ï∂îÍ∞Ä')">Ice</button>
                <button class="btn-hot btn-shot order-btn" onclick="addEtcOrder('Hot +ÏÉ∑Ï∂îÍ∞Ä')">Hot</button>
            </div>
        </div>
    </div>

    <div class="order-summary">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 style="font-size:1.1rem; margin:0;">Ïò§ÎäòÏùò Ï£ºÎ¨∏ üõí</h2>
            <button style="width:auto; padding:5px 10px; font-size:0.75rem; background:#eee;" onclick="clearAllOrders()">Ï¥àÍ∏∞Ìôî</button>
        </div>
        <ul id="order-list" style="list-style:none; padding:0; margin:15px 0 0 0;"></ul>
        <div style="text-align:right; font-weight:bold; margin-top:15px; border-top:1px solid #eee; padding-top:10px;">
            Ï¥ù ÏàòÎüâ: <span id="total-count">0</span>Í∞ú
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBSxM3W_RkCt8poqQJxVhIgYMPqLuZgT6Y",
        authDomain: "menusame-6a326.firebaseapp.com",
        databaseURL: "https://menusame-6a326-default-rtdb.firebaseio.com",
        projectId: "menusame-6a326",
        storageBucket: "menusame-6a326.firebasestorage.app",
        messagingSenderId: "822750462446",
        appId: "1:822750462446:web:1cc67bd3f2b49e52670eff"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentCategory = 'morning';
    const TIMES = {
        morning: { open: 7*3600, close: 7*3600+58*60, label: "ÏïÑÏπ® (07:00~07:58)" },
        daily: { open: 9*3600, close: 18*3600, label: "ÏùºÏÉÅ (09:00~18:00)" }
    };

    function getKSTSeconds() {
        const now = new Date();
        const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
        const krTime = new Date(utc + (9 * 3600000));
        return krTime.getHours() * 3600 + krTime.getMinutes() * 60 + krTime.getSeconds();
    }

    function switchTab(type) {
        currentCategory = type;
        document.getElementById('tab-morning').classList.toggle('active', type === 'morning');
        document.getElementById('tab-daily').classList.toggle('active', type === 'daily');
        updateTimer();
    }

    function updateTimer() {
        const curSec = getKSTSeconds();
        const config = TIMES[currentCategory];
        const timerEl = document.getElementById('time-left');
        const labelEl = document.getElementById('timer-label');
        const btns = document.querySelectorAll('.order-btn');
        document.getElementById('notice-text').innerText = `Ïö¥ÏòÅÏãúÍ∞Ñ: ${config.label}`;

        if (curSec >= config.open && curSec < config.close) {
            labelEl.innerText = "ÏòÅÏóÖÏãúÍ∞Ñ";
            btns.forEach(b => b.disabled = false);
            const diff = config.close - curSec;
            const h = Math.floor(diff/3600).toString().padStart(2,'0');
            const m = Math.floor((diff%3600)/60).toString().padStart(2,'0');
            const s = (diff%60).toString().padStart(2,'0');
            timerEl.innerText = `${h}:${m}:${s}`;
        } else {
            labelEl.innerText = curSec < config.open ? "Ï£ºÎ¨∏ ÏãúÏûë Ï†Ñ" : "ÏòÅÏóÖ Ï¢ÖÎ£å";
            timerEl.innerText = "00:00:00";
            btns.forEach(b => b.disabled = true);
        }
    }

    function addOrder(fullMenuName) {
        const curSec = getKSTSeconds();
        const config = TIMES[currentCategory];
        if (curSec < config.open || curSec >= config.close) {
            alert("Ï£ºÎ¨∏ Í∞ÄÎä• ÏãúÍ∞ÑÏù¥ ÏïÑÎãôÎãàÎã§!");
            return;
        }

        const prefix = currentCategory === 'morning' ? "ÏïÑÏπ®_" : "ÏùºÏÉÅ_";
        const fullKey = prefix + fullMenuName;
        db.ref('orders/' + fullKey).transaction((cv) => (cv || 0) + 1);
    }

    function addEtcOrder(suffix) {
        const name = document.getElementById('etc-name').value.trim();
        if(!name) return alert("Î©îÎâ¥Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî");
        addOrder(`${name} (${suffix})`);
        document.getElementById('etc-name').value = "";
    }

    window.adjustQty = function(key, amt) {
        db.ref('orders/' + key).transaction((cv) => {
            const nv = (cv || 0) + amt;
            return nv <= 0 ? null : nv;
        });
    };

    function clearAllOrders() {
        if(confirm("ÏùåÎ£åÎ≥Ñ Ï¥àÍ∏∞ÌôîÎäî Ï†úÌíàÏòÜ "-"" Î≤ÑÌäºÏùÑ ÎàåÎü¨ "0" ÏúºÎ°ú ÎßåÎì§Ïñ¥Ï£ºÏÑ∏Ïöî. Ï†ïÎßêÎ°ú Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî ÌïòÏãúÍ≤†ÏäµÎãàÍπå? Ìú¥Î®º??")) db.ref('orders').remove();
    }

    db.ref('orders').on('value', (snapshot) => {
        const orders = snapshot.val() || {};
        const listEl = document.getElementById('order-list');
        const totalEl = document.getElementById('total-count');
        listEl.innerHTML = "";
        let total = 0;

        Object.keys(orders).forEach(key => {
            const count = orders[key];
            const li = document.createElement('li');
            li.className = 'order-item';
            li.innerHTML = `<span style="font-size:0.9rem;">${key}</span>
                <div style="display:flex; align-items:center; gap:10px;">
                    <button class="btn-count" onclick="adjustQty('${key}', -1)">-</button>
                    <span style="font-weight:bold; min-width:20px; text-align:center;">${count}</span>
                    <button class="btn-count" onclick="adjustQty('${key}', 1)">+</button>
                </div>`;
            listEl.appendChild(li);
            total += count;
        });
        totalEl.innerText = total;
    });

    const nowSec = getKSTSeconds();
    if (nowSec >= TIMES.morning.open && nowSec < TIMES.morning.close) switchTab('morning');
    else switchTab('daily');

    setInterval(updateTimer, 1000);
</script>
</body>
</html>