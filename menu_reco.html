<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì‹œê°„ ë©”ë‰´ ë™ê¸°í™”</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Do+Hyeon&display=swap');

        body {
            background-color: #2d3436;
            color: white;
            font-family: 'Do Hyeon', sans-serif;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            height: 100vh; margin: 0;
        }

        .container {
            text-align: center;
            width: 90%; max-width: 400px;
            background: #222; padding: 30px;
            border-radius: 20px; border: 4px solid #fdcb6e;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .status {
            font-size: 0.9rem; color: #00b894; margin-bottom: 10px;
        }

        .slot-window {
            height: 150px; background: white; color: #333;
            border-radius: 10px; overflow: hidden; position: relative;
            margin: 20px 0; border: 3px solid #333;
        }

        .reel {
            list-style: none; padding: 0; margin: 0;
            transform: translateY(0);
        }

        .reel li {
            height: 150px; display: flex; align-items: center; justify-content: center;
            font-size: 3rem; font-family: 'Black Han Sans', sans-serif;
            border-bottom: 1px solid #ddd;
        }

        button {
            width: 100%; padding: 20px; font-size: 1.5rem;
            background: #d63031; color: white; border: none;
            border-radius: 50px; cursor: pointer;
            font-family: 'Black Han Sans', sans-serif;
            transition: 0.2s; box-shadow: 0 5px 0 #b71c1c;
        }
        button:active { transform: translateY(5px); box-shadow: none; }
        button:disabled { background: #636e72; cursor: not-allowed; box-shadow: none; }
        
        .winner { color: #d63031; }
    </style>
</head>
<body>

    <div class="container">
        <div class="status">ğŸŸ¢ ì„œë²„ ì—°ê²° ëŒ€ê¸°ì¤‘...</div>
        <h1>ğŸ“¡ ì‹¤ì‹œê°„ ë©”ë‰´ ì¶”ì²¨</h1>
        
        <div class="slot-window">
            <ul class="reel" id="reel">
                <li>READY</li>
            </ul>
        </div>

        <button id="spin-btn" onclick="sendTrigger()">ë‹¤ê°™ì´ ëŒë¦¬ê¸°!</button>
        <p style="font-size:0.8rem; color:#aaa; margin-top:10px;">ë‚´ê°€ ëˆ„ë¥´ë©´ ì¹œêµ¬ í™”ë©´ë„ ëŒì•„ê°‘ë‹ˆë‹¤</p>
    </div>

    <script>
        // ========================================================
        // ğŸ”´ [ì¤‘ìš”] ì—¬ê¸°ì— ë³¸ì¸ì˜ íŒŒì´ì–´ë² ì´ìŠ¤ ì„¤ì •ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”! ğŸ”´
        // ì•„ë˜ ë‚´ìš©ì„ ì§€ìš°ê³  ë³µì‚¬í•œ firebaseConfig ë‚´ìš©ì„ ë„£ìœ¼ì„¸ìš”.
        // ========================================================
        const firebaseConfig = {
          apiKey: "AIzaSyBSxM3W_RkCt8poqQJxVhIgYMPqLuZgT6Y",
    authDomain: "menusame-6a326.firebaseapp.com",
    databaseURL: "https://menusame-6a326-default-rtdb.firebaseio.com",
    projectId: "menusame-6a326",
    storageBucket: "menusame-6a326.firebasestorage.app",
    messagingSenderId: "822750462446",
    appId: "1:822750462446:web:1cc67bd3f2b49e52670eff"
        };
        // ========================================================

        // 1. íŒŒì´ì–´ë² ì´ìŠ¤ ì´ˆê¸°í™”
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        // ì—°ê²° ìƒíƒœ í™•ì¸
        const statusDiv = document.querySelector('.status');
        const connectedRef = db.ref(".info/connected");
        connectedRef.on("value", (snap) => {
            if (snap.val() === true) {
                statusDiv.innerHTML = "ğŸŸ¢ ì„œë²„ ì—°ê²°ë¨ (ì¤€ë¹„ ì™„ë£Œ)";
            } else {
                statusDiv.innerHTML = "ğŸ”´ ì—°ê²° ëŠê¹€";
            }
        });

        // 2. ë©”ë‰´ ë°ì´í„°
        const menus = [
            "ê¹€ì¹˜ì°Œê°œ", "ëœì¥ì°Œê°œ", "ë¶€ëŒ€ì°Œê°œ", "ì§œì¥ë©´", "ì§¬ë½•", "íƒ•ìˆ˜ìœ¡",
            "ì¹˜í‚¨", "í”¼ì", "ì‚¼ê²¹ì‚´", "ë–¡ë³¶ì´", "ë¼ë©´", "ëˆê¹ŒìŠ¤",
            "ì´ˆë°¥", "ì¡±ë°œ", "ë³´ìŒˆ", "ìŒ€êµ­ìˆ˜", "ë§ˆë¼íƒ•", "êµ­ë°¥"
        ];

        const reel = document.getElementById('reel');
        const btn = document.getElementById('spin-btn');
        let lastTriggerTime = 0;

        // --------------------------------------------------------
        // ê¸°ëŠ¥ A: ë²„íŠ¼ ëˆ„ë¥´ë©´ -> ì„œë²„ì— "ëŒë ¤!" ëª…ë ¹ ë³´ë‚´ê¸° (ì“°ê¸°)
        // --------------------------------------------------------
        function sendTrigger() {
            // ë¯¸ë¦¬ ë‹¹ì²¨ ë©”ë‰´ë¥¼ ì •í•´ì„œ ë³´ëƒ…ë‹ˆë‹¤ (ê·¸ë˜ì•¼ ëª¨ë‘ê°€ ê°™ì€ ê±¸ ë´„)
            const winnerIndex = Math.floor(Math.random() * menus.length);
            
            // ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥
            db.ref('slot_game').set({
                timestamp: Date.now(), // í˜„ì¬ ì‹œê°„
                winnerIndex: winnerIndex // ë‹¹ì²¨ ë²ˆí˜¸
            });
        }

        // --------------------------------------------------------
        // ê¸°ëŠ¥ B: ì„œë²„ ì‹ í˜¸ ê°ì§€ -> ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰ (ì½ê¸°)
        // --------------------------------------------------------
        const gameRef = db.ref('slot_game');
        
        // ëˆ„êµ°ê°€ DBë¥¼ ì—…ë°ì´íŠ¸í•˜ë©´ ì´ í•¨ìˆ˜ê°€ ìë™ìœ¼ë¡œ ì‹¤í–‰ë¨
        gameRef.on('value', (snapshot) => {
            const data = snapshot.val();
            
            // ë°ì´í„°ê°€ ìˆê³ , ìƒˆë¡œ ë“¤ì–´ì˜¨ ì‹ í˜¸ë¼ë©´ (ì¤‘ë³µ ë°©ì§€)
            if (data && data.timestamp > lastTriggerTime) {
                lastTriggerTime = data.timestamp;
                runSyncAnimation(data.winnerIndex);
            }
        });

        // --------------------------------------------------------
        // ì‹¤ì œ í™”ë©´ ì• ë‹ˆë©”ì´ì…˜ (ê³µí†µ)
        // --------------------------------------------------------
        function runSyncAnimation(winnerIndex) {
            btn.disabled = true;
            btn.innerText = "ì¶”ì²¨ ì§„í–‰ ì¤‘...";
            
            const winnerMenu = menus[winnerIndex];
            const itemHeight = 150; 
            const spinCount = 20;

            // ë¦´ ì´ˆê¸°í™”
            reel.style.transition = 'none';
            reel.style.transform = 'translateY(0)';
            reel.innerHTML = '';

            // ëœë¤ ë©”ë‰´ ì±„ìš°ê¸°
            for(let i=0; i<spinCount; i++) {
                const li = document.createElement('li');
                li.innerText = menus[Math.floor(Math.random() * menus.length)];
                reel.appendChild(li);
            }
            // ë§ˆì§€ë§‰ ë‹¹ì²¨ ë©”ë‰´
            const winLi = document.createElement('li');
            winLi.innerText = winnerMenu;
            winLi.classList.add('winner');
            reel.appendChild(winLi);

            // ê°•ì œ ë¦¬í”Œë¡œìš° (ì• ë‹ˆë©”ì´ì…˜ ê¼¬ì„ ë°©ì§€)
            void reel.offsetWidth;

            // íšŒì „ ì‹œì‘
            const targetY = -(spinCount * itemHeight);
            reel.style.transition = 'transform 3s cubic-bezier(0.1, 0.9, 0.2, 1)';
            reel.style.transform = `translateY(${targetY}px)`;

            // ì¢…ë£Œ í›„ ë³µêµ¬
            setTimeout(() => {
                btn.disabled = false;
                btn.innerText = "ë‹¤ê°™ì´ ëŒë¦¬ê¸°!";
            }, 3000);
        }
    </script>
</body>
</html>