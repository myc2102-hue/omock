<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš´ëª…ì˜ ë©”ë‰´ ì„ íƒ - FINAL EDITION</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Do+Hyeon&family=Press+Start+2P&family=Share+Tech+Mono&display=swap');

        :root {
            --machine-bg: #1e1e1e;
            --machine-border: #444;
            --gold: #f1c40f;
            --neon-green: #00ff88;
            --neon-red: #ff0055;
            --neon-blue: #00d2d3;
            --screen-bg: #fff;
            --pixel-font: 'Press Start 2P', cursive;
            --tech-font: 'Share Tech Mono', monospace;
        }

        body {
            background-color: #000;
            background-image: 
                linear-gradient(rgba(0, 255, 136, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 136, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
            display: flex; justify-content: center; align-items: flex-start;
            min-height: 100vh; margin: 0; font-family: 'Do Hyeon', sans-serif;
            color: white;
            padding-top: 60px;
            box-sizing: border-box;
            overflow-y: auto;
        }

        /* ğŸ“¢ ìƒë‹¨ ê³ ì • ê³µì§€ ë°” */
        .top-notice-bar {
            position: fixed; top: 0; left: 0; width: 100%;
            background-color: rgba(0, 20, 0, 0.95);
            border-bottom: 1px solid var(--neon-green);
            color: var(--neon-green); padding: 12px 0;
            text-align: center; font-size: 0.9rem; z-index: 9999;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.2);
            backdrop-filter: blur(5px); white-space: nowrap; overflow: hidden;
        }
        .blink-text { animation: blink-text 2s infinite; font-weight: bold; }
        @keyframes blink-text { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* ğŸ“ ì „ì²´ ë ˆì´ì•„ì›ƒ */
        .main-layout {
            display: flex;
            flex-direction: row;
            gap: 20px;
            align-items: flex-start;
            justify-content: center;
            width: 100%;
            max-width: 900px;
            padding: 20px;
        }

        .left-sidebar {
            display: flex; flex-direction: column; gap: 20px;
            width: 320px; flex-shrink: 0;
        }

        .game-container {
            flex-grow: 1; width: 100%; max-width: 450px;
        }

        @media (max-width: 850px) {
            .main-layout { flex-direction: column; align-items: center; }
            .left-sidebar { width: 100%; max-width: 450px; order: 2; }
            .game-container { width: 100%; order: 1; }
        }

        /* ğŸ† ë­í‚¹ íŒ¨ë„ */
        .ranking-panel {
            width: 100%; background: rgba(0, 0, 0, 0.8);
            border: 2px solid var(--gold); border-radius: 15px; padding: 20px;
            box-sizing: border-box; box-shadow: 0 0 20px rgba(241, 196, 15, 0.1);
            font-family: var(--tech-font);
        }
        .ranking-title {
            color: var(--gold); font-family: 'Black Han Sans', sans-serif;
            font-size: 1.3rem; text-align: center; margin-bottom: 15px;
            text-shadow: 2px 2px 0 #000; border-bottom: 1px solid #333; padding-bottom: 10px;
        }
        .ranking-list { list-style: none; padding: 0; margin: 0; }
        .ranking-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 8px 5px; border-bottom: 1px solid #333; font-size: 0.9rem;
        }
        .rank-num { font-weight: bold; color: var(--neon-green); margin-right: 10px; width: 20px; }
        .rank-name { flex-grow: 1; color: white; font-family: 'Do Hyeon', sans-serif; }
        .rank-count { color: var(--gold); font-weight: bold; }
        .ranking-item:nth-child(1) .rank-num { color: #ffd700; text-shadow: 0 0 5px #ffd700; font-size: 1.1rem; }
        .ranking-item:nth-child(2) .rank-num { color: #c0c0c0; }
        .ranking-item:nth-child(3) .rank-num { color: #cd7f32; }

        /* ğŸ’¬ ì±„íŒ… íŒ¨ë„ */
        .chat-panel {
            width: 100%; background-color: #000; border: 1px solid #555; border-radius: 10px;
            padding: 15px; box-sizing: border-box; font-family: var(--tech-font);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.05);
        }
        .chat-header {
            font-size: 0.8rem; color: #aaa; border-bottom: 1px solid #333;
            padding-bottom: 5px; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .online-status {
            color: var(--neon-green); font-weight: bold;
            display: flex; align-items: center; gap: 5px;
        }
        .status-led {
            width: 8px; height: 8px; background-color: var(--neon-green);
            border-radius: 50%; box-shadow: 0 0 5px var(--neon-green);
            animation: blink 1.5s infinite;
        }
        .chat-messages {
            height: 200px; overflow-y: auto; border: 1px solid #222; padding: 5px; margin-bottom: 10px;
            font-size: 0.8rem; color: #ddd; scrollbar-width: thin; scrollbar-color: #444 #111;
        }
        .chat-messages::-webkit-scrollbar { width: 5px; }
        .chat-messages::-webkit-scrollbar-thumb { background: #444; }
        .msg-line { margin-bottom: 4px; word-break: break-all; }
        .msg-nick { color: var(--neon-green); font-weight: bold; margin-right: 5px; }
        .msg-text { color: #fff; }
        .sys-msg { color: #aaa; font-style: italic; }
        .chat-input-area { display: flex; gap: 5px; flex-wrap: wrap;}
        .nick-input { background: #111; border: 1px solid #333; color: var(--gold); padding: 8px; width: 70px; font-family: 'Do Hyeon', sans-serif; border-radius: 3px; text-align: center; }
        .chat-input { background: #111; border: 1px solid #333; color: white; padding: 8px; flex-grow: 1; font-family: 'Do Hyeon', sans-serif; border-radius: 3px; }
        .send-btn { width: auto; padding: 0 15px; font-size: 0.9rem; background: #333; border: 1px solid #555; border-radius: 3px; box-shadow: none; color: white; cursor: pointer; }
        .send-btn:hover { background: #444; }

        /* ğŸ‘¥ ëˆ„ì  ë°©ë¬¸ì íŒ¨ë„ */
        .visitor-panel {
            width: 100%; background-color: #000; border: 1px solid #333;
            border-radius: 10px; padding: 15px; box-sizing: border-box;
            font-family: var(--tech-font); display: flex; align-items: center; gap: 15px;
            box-shadow: 0 0 15px rgba(0, 210, 211, 0.1);
        }
        .visitor-icon { font-size: 1.5rem; }
        .visitor-info { display: flex; flex-direction: column; }
        .visitor-label { font-size: 0.7rem; color: #aaa; margin-bottom: 5px; }
        .visitor-count { font-size: 1.3rem; color: var(--neon-blue); font-weight: bold; font-family: 'Black Han Sans', sans-serif; letter-spacing: 1px; text-shadow: 0 0 10px var(--neon-blue); }

        /* ğŸ° ìŠ¬ë¡¯ë¨¸ì‹  */
        .slot-machine {
            background: linear-gradient(180deg, #2d3436 0%, #000 100%);
            width: 100%; padding: 30px; border-radius: 20px;
            box-shadow: 0 0 60px rgba(0, 255, 136, 0.15);
            border: 4px solid var(--machine-border);
            text-align: center; position: relative; box-sizing: border-box;
        }
        .server-status-bar {
            background: #000; border: 1px solid #333; padding: 8px 15px;
            border-radius: 5px; margin-bottom: 20px; display: flex;
            justify-content: space-between; align-items: center;
            font-family: var(--tech-font); font-size: 0.9rem; color: var(--neon-green);
        }
        .live-dot {
            width: 8px; height: 8px; background: var(--neon-green); border-radius: 50%;
            box-shadow: 0 0 8px var(--neon-green); animation: blink 1s infinite; display: inline-block; margin-right: 5px;
        }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        h1 { color: var(--gold); margin: 0 0 15px 0; font-size: 2.5rem; font-family: 'Black Han Sans', sans-serif; text-shadow: 3px 3px 0px #000; -webkit-text-stroke: 1px #000; }

        .curse-warning {
            background-color: rgba(255, 0, 85, 0.1); color: #ecf0f1; padding: 12px;
            border-radius: 5px; margin-bottom: 20px; font-size: 1rem; line-height: 1.4;
            border: 1px dashed var(--neon-red); text-shadow: 1px 1px 2px black;
        }
        .curse-warning span { color: var(--neon-red); font-weight: bold; }

        .window-frame { background-color: #333; padding: 10px; border-radius: 10px; margin-bottom: 10px; border: 2px solid var(--gold); }
        .window { height: 100px; background-color: var(--screen-bg); border-radius: 5px; overflow: hidden; position: relative; border: 3px solid #000; }
        .reel { list-style: none; padding: 0; margin: 0; transform: translateY(0); }
        .reel li { height: 100px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: bold; color: #333; border-bottom: 1px dashed #ddd; box-sizing: border-box; }
        .highlight-text { color: var(--neon-red) !important; text-shadow: 1px 1px 0 rgba(0,0,0,0.1); }

        #result-display { font-family: var(--tech-font); color: var(--neon-green); min-height: 1.5rem; margin-bottom: 15px; font-size: 1.1rem; }

        button {
            background: radial-gradient(circle at 30% 30%, #e17055, #d63031); border: 4px solid #fff; color: white;
            font-size: 1.5rem; font-family: 'Black Han Sans', sans-serif; padding: 15px 0; border-radius: 50px; cursor: pointer; width: 100%;
            box-shadow: 0 5px 0 #b71c1c, 0 10px 20px rgba(0,0,0,0.5); transition: all 0.1s; text-shadow: 1px 1px 0 rgba(0,0,0,0.2);
        }
        button:active { transform: translateY(5px); box-shadow: 0 0 0 #b71c1c; }
        button:disabled { filter: grayscale(100%); cursor: progress; background: #555; }

        .marquee-container { background-color: #111; border: 1px solid #333; height: 25px; margin-top: 15px; overflow: hidden; position: relative; display: flex; align-items: center; }
        .marquee-text { position: absolute; white-space: nowrap; color: var(--gold); font-size: 10px; font-family: var(--pixel-font); animation: marquee 12s linear infinite; }
        @keyframes marquee { 0% { left: 100%; } 100% { left: -100%; } }
    </style>
</head>
<body>

<div class="top-notice-bar">
    <span class="blink-text">ğŸ”´ LIVE</span> í•´ë‹¹í˜ì´ì§€ì— ì ‘ì†í•œ ì¸ì›ì€ ëª¨ë‘ ê°™ì€ í™”ë©´ì„ ë¼ì´ë¸Œë¡œ ë³´ê³ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ ì‹¤ì‹œê°„ ì±„íŒ…ì„ ì´ìš©í•˜ì„¸ìš”.
</div>

<div class="main-layout">
    
    <div class="left-sidebar">
        
        <div class="ranking-panel">
            <div class="ranking-title">ğŸ† ëˆ„ì  ë­í‚¹ TOP 5</div>
            <ul class="ranking-list" id="ranking-list">
                <li style="text-align:center; color:#666; padding:20px;">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>
            </ul>
        </div>

        <div class="chat-panel">
            <div class="chat-header">
                <span>SECURE COMMS</span>
                <span class="online-status">
                    <div class="status-led"></div>
                    <span id="chat-online-count">0</span> ONLINE
                </span>
            </div>
            <div class="chat-messages" id="chat-box">
                <div class="msg-line sys-msg">>> System initialized...</div>
            </div>
            <div class="chat-input-area">
                <input type="text" class="nick-input" id="my-nick" placeholder="ë‹‰ë„¤ì„" maxlength="6">
                <input type="text" class="chat-input" id="my-msg" placeholder="ì±„íŒ… ì…ë ¥..." onkeypress="if(event.keyCode==13) sendChat()">
                <button class="send-btn" onclick="sendChat()">ì „ì†¡</button>
            </div>
        </div>

        <div class="visitor-panel">
            <div class="visitor-icon">ğŸ‘¥</div>
            <div class="visitor-info">
                <span class="visitor-label">TOTAL VISITORS</span>
                <span class="visitor-count" id="total-visitor-count">LOADING...</span>
            </div>
        </div>

    </div>

    <div class="game-container">
        <div class="slot-machine">
            <div class="server-status-bar">
                <div><span class="live-dot" id="status-dot"></span><span id="conn-text">CONNECTING...</span></div>
                <div style="font-size: 0.8rem; color: #666;">SERVER: KOR-1</div>
            </div>

            <h1>ğŸ° MENU PICK ğŸ°</h1>

            <div class="curse-warning">
                âš ï¸ <strong>SYSTEM WARNING</strong> âš ï¸<br>
                ì„ íƒëœ ë©”ë‰´ ì„­ì·¨ ê±°ë¶€ ì‹œ<br>
                <span>3ì¼ê°„ ìƒì²´ ë¦¬ë“¬(ì„¤ì‚¬) ë¶•ê´´ë¨.</span>
            </div>

            <div class="window-frame">
                <div class="window">
                    <ul class="reel" id="reel">
                        <li>Ready</li>
                    </ul>
                </div>
            </div>

            <div id="result-display">WAITING FOR SIGNAL...</div>

            <button id="spin-btn" onclick="sendTrigger()">BROADCAST SPIN</button>

            <div class="marquee-container">
                <div class="marquee-text">
                    [ê°œë°œì í›„ì›] ë†í˜‘ 3020780286881 ë¬¸xì²  (ì§€ì‚¬ì œ ê°’ ëª¨ê¸ˆì¤‘...) &nbsp;&nbsp;&nbsp; â˜… WINNER EATS ALL â˜…
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    // ========================================================
    // ğŸŸ¢ íŒŒì´ì–´ë² ì´ìŠ¤ ì„¤ì •
    // ========================================================
    const firebaseConfig = {
      apiKey: "AIzaSyBSxM3W_RkCt8poqQJxVhIgYMPqLuZgT6Y",
      authDomain: "menusame-6a326.firebaseapp.com",
      databaseURL: "https://menusame-6a326-default-rtdb.firebaseio.com",
      projectId: "menusame-6a326",
      storageBucket: "menusame-6a326.firebasestorage.app",
      messagingSenderId: "822750462446",
      appId: "1:822750462446:web:1cc67bd3f2b49e52670eff"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ========================================================
    // ğŸš« ê¸ˆì¹™ì–´ ë¦¬ìŠ¤íŠ¸ (ë¹„ì†ì–´ í•„í„°)
    // ========================================================
    const bannedWords = [
        "ì‹œë°œ", "ì”¨ë°œ", "ã……ã…‚", "ã…†ã…‚", "ê°œìƒˆë¼", "ê°œìƒˆí‚¤", "ë³‘ì‹ ", "ã…„", "ã…‚ã……", "ì§€ë„", "ã…ˆã„¹",
        "ì¡´ë‚˜", "ì¡¸ë¼", "ë¯¸ì¹œ", "ë¯¸ì¹œë†ˆ", "ë¯¸ì¹œë…„", "ã…ã…Š", "ì• ì", "ì°½ë…€", "ê±¸ë ˆ", "ë”°ë¨¹",
        "ëŠê¸ˆë§ˆ", "ë‹ˆì• ë¯¸", "ë‹ˆì• ë¹„", "ì— ì°½", "ëŠê°œë¹„", "ì…", "ì”¨ì•™", "ì¢†", "ì¢ƒ", "ëŒ€ê°€ë¦¬",
        "í˜¸ë¡œ", "ì—¼ë³‘", "êº¼ì ¸", "ë‹¥ì³", "ì•„ê°€ë¦¬", "ì°ë”°", "ì“°ë ˆê¸°", "ë’¤ì ¸", "ë‚˜ê°€ë’¤ì ¸",
        "ì”¨ë¶€ë„", "ê°œë†ˆ", "ê°œë…„", "ì”¹", "ì”¹ìƒˆ", "ìƒˆë¼", "ë¹™ì‹ ", "í˜¸êµ¬", "ë‹ˆë¯¸", "ì—¿ë¨¹ì–´",
        "ì„¹ìŠ¤", "ìì§€", "ë³´ì§€", "ì½˜ë”", "ì•¼ë™", "ë§ê°€", "ì„±í­í–‰", "ê°•ê°„", "ì›ì¡°êµì œ", "ë³€íƒœ",
        "ë˜ë¼ì´", "ì‹¸ê°€ì§€", "ì¬ìˆ˜ì—†ì–´", "ì£½ì–´", "ì‚´ì¸", "ì¹¼ë¹µ", "ì¥ì• ì¸", "ë§˜ì¶©", "í•œë‚¨", "ê¹€ì¹˜ë…€",
        "ì§±ê¹¨", "ìª½ë°”ë¦¬", "ë‹ˆê¸°ë¯¸", "ì˜˜ë³‘", "ìœ¡ì‹œë„", "ë“±ì‹ ", "ëª¨ì§€ë¦¬", "í˜¸ë¡œìì‹", "í›„ë ˆìì‹",
        "fuck", "shit", "bitch", "asshole", "dick", "pussy", "cunt", "bastard", "whore",
        "slut", "nigger", "nigga", "fag", "faggot", "sex", "rape", "penis", "vagina",
        "cock", "suck", "motherfucker", "fucking", "shitty", "bullshit", "jackass", "douche",
        "retard", "idiot", "stupid", "moron", "imbecile", "trash", "scum", "loser",
        "die", "kill", "suicide", "murder", "stfu", "gtfo", "wtf", "omg", "ass",
        "boobs", "tits", "porn", "xxx", "hentai", "anal", "oral", "orgasm", "cum", "jizz",
        "damn", "hell", "crap", "piss", "bloody", "wanker", "bollocks", "bugger", "twat",
        "prick", "sod", "shag", "tosser", "wank", "knob", "bellend", "muppet", "chink",
        "gook", "spic", "kike", "wetback", "tranny", "shemale", "hitler", "nazi"
    ];

    function containsBadWord(text) {
        if (!text) return false;
        const lowerText = text.toLowerCase().replace(/\s/g, ""); 
        for (let word of bannedWords) {
            if (lowerText.includes(word)) return true;
        }
        return false;
    }

    // DOM ìš”ì†Œ
    const reel = document.getElementById('reel');
    const btn = document.getElementById('spin-btn');
    const resultDisplay = document.getElementById('result-display');
    const connText = document.getElementById('conn-text');
    const statusDot = document.getElementById('status-dot');
    const chatOnlineCount = document.getElementById('chat-online-count');
    const chatBox = document.getElementById('chat-box');
    const nickInput = document.getElementById('my-nick');
    const msgInput = document.getElementById('my-msg');
    const rankingList = document.getElementById('ranking-list');
    const totalVisitorCount = document.getElementById('total-visitor-count');

    // ğŸ“¡ ê¸°ëŠ¥ 1: ì ‘ì†ì ìˆ˜ & ìƒíƒœ
    const onlineRef = db.ref(".info/connected");
    const presenceRef = db.ref("presence");
    
    onlineRef.on("value", (snap) => {
        if (snap.val() === true) {
            connText.innerText = "LIVE SYNC ON";
            connText.style.color = "#00ff88";
            statusDot.style.backgroundColor = "#00ff88";
            statusDot.style.boxShadow = "0 0 8px #00ff88";
            const myCon = presenceRef.push();
            myCon.onDisconnect().remove();
            myCon.set(true);
        } else {
            connText.innerText = "OFFLINE";
            connText.style.color = "#ff0055";
            statusDot.style.backgroundColor = "#ff0055";
            statusDot.style.boxShadow = "none";
        }
    });

    presenceRef.on("value", (snap) => {
        chatOnlineCount.innerText = snap.numChildren();
    });

    // ğŸ‘¥ ê¸°ëŠ¥ 2: ëˆ„ì  ë°©ë¬¸ì ìˆ˜ (Total Visitors)
    // ì ‘ì† ì‹œë§ˆë‹¤ +1 ì¦ê°€ì‹œí‚¤ê³  í™”ë©´ì— í‘œì‹œ
    const globalVisitsRef = db.ref('global_visits');
    
    // 1. ì¦ê°€ ë¡œì§ (ìƒˆë¡œê³ ì¹¨ ì‹œë§ˆë‹¤ ì¦ê°€)
    globalVisitsRef.transaction((current) => {
        return (current || 0) + 1;
    });

    // 2. í‘œì‹œ ë¡œì§ (ê°’ì´ ë°”ë€” ë•Œë§ˆë‹¤ ê°±ì‹ )
    globalVisitsRef.on('value', (snap) => {
        const count = snap.val() || 0;
        totalVisitorCount.innerText = count.toLocaleString(); // ì½¤ë§ˆ ì°ì–´ì„œ í‘œì‹œ
    });


    // ğŸ’¬ ê¸°ëŠ¥ 3: ì±„íŒ… ì „ì†¡ (í•„í„° ì ìš©)
    function sendChat() {
        const msg = msgInput.value.trim();
        if (msg === "") return;

        let nickname = nickInput.value.trim();
        if (nickname === "") nickname = "ìµëª…";

        if (containsBadWord(msg) || containsBadWord(nickname)) {
            alert("ğŸš« ë°”ë¥¸ë§ ê³ ìš´ë§ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”! (SYSTEM ALERT)\në¹„ì†ì–´ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.");
            msgInput.value = ""; 
            return;
        }

        db.ref('chat_logs').push({
            name: nickname,
            text: msg,
            time: Date.now()
        });

        msgInput.value = "";
    }

    db.ref('chat_logs').limitToLast(30).on('child_added', (snap) => {
        const data = snap.val();
        appendMessage(data.name, data.text);
    });

    function appendMessage(name, text) {
        const div = document.createElement('div');
        div.className = 'msg-line';
        div.innerHTML = `<span class="msg-nick">[${name}]</span> <span class="msg-text">${text}</span>`;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    // ğŸ† ê¸°ëŠ¥ 4: ì‹¤ì‹œê°„ ë­í‚¹ ì‹œìŠ¤í…œ
    const statsRef = db.ref('menu_stats');

    // ë­í‚¹ ë°ì´í„°ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ í™”ë©´ ê°±ì‹ 
    statsRef.on('value', (snap) => {
        const data = snap.val();
        if(!data) {
            rankingList.innerHTML = '<li style="text-align:center; padding:10px; color:#aaa;">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</li>';
            return;
        }

        const sortedMenus = Object.entries(data)
            .sort((a, b) => b[1] - a[1]) 
            .slice(0, 5); 

        rankingList.innerHTML = '';
        sortedMenus.forEach((item, index) => {
            const menuName = item[0];
            const count = item[1];
            
            const li = document.createElement('li');
            li.className = 'ranking-item';
            li.innerHTML = `
                <div style="display:flex; align-items:center; width:100%;">
                    <span class="rank-num">${index + 1}</span>
                    <span class="rank-name">${menuName}</span>
                    <span class="rank-count">${count}íšŒ</span>
                </div>
            `;
            rankingList.appendChild(li);
        });
    });

    // ğŸ° ê¸°ëŠ¥ 5: ìŠ¬ë¡¯ë¨¸ì‹ 
    const menus = [
        "ê¹€ì¹˜ì°Œê°œ", "ëœì¥ì°Œê°œ", "ë¶€ëŒ€ì°Œê°œ", "ë¹„ë¹”ë°¥", "ë¶ˆê³ ê¸°", "ê°ˆë¹„íƒ•", "ì‚¼ê³„íƒ•", "ì œìœ¡ë³¶ìŒ", "ë–¡ë³¶ì´", "ìˆœëŒ€êµ­",
        "ë¼ë©´", "ê¹€ë°¥", "ì§œì¥ë©´", "ì§¬ë½•", "íƒ•ìˆ˜ìœ¡", "ë§ˆíŒŒë‘ë¶€", "ì–‘ê¼¬ì¹˜", "ë§ˆë¼íƒ•", "í› ê¶ˆ", "ë³¶ìŒë°¥",
        "ì´ˆë°¥", "ëˆê¹ŒìŠ¤", "ìš°ë™", "ì†Œë°”", "ë¼ë©˜", "ê·œë™", "ê°€ì¸ ë™", "ì˜¤ì½”ë…¸ë¯¸ì•¼í‚¤", "íƒ€ì½”ì•¼í‚¤", "ì¹´ë ˆ",
        "í”¼ì", "íŒŒìŠ¤íƒ€", "ìŠ¤í…Œì´í¬", "í–„ë²„ê±°", "ìƒŒë“œìœ„ì¹˜", "ìƒëŸ¬ë“œ", "ë¦¬ì¡°ë˜", "ê·¸ë¼íƒ•", "ë¸ŒëŸ°ì¹˜", "íƒ€ì½”",
        "ìŒ€êµ­ìˆ˜", "íŒŸíƒ€ì´", "ë‚˜ì‹œê³ ë­", "ë°˜ë¯¸", "ë¶„ì§œ", "ì¹˜í‚¨", "ì°œë‹­", "ë‹­ê°ˆë¹„", "ì¡±ë°œ", "ë³´ìŒˆ",
        "ì„¤ë íƒ•", "ìœ¡ê°œì¥", "ì¹¼êµ­ìˆ˜", "ìˆ˜ì œë¹„", "ëƒ‰ë©´", "ì½©êµ­ìˆ˜", "ì•„êµ¬ì°œ", "í•´ë¬¼ì°œ", "ë‚™ì§€ë³¶ìŒ", "ì˜¤ì§•ì–´ë®ë°¥", "êµ¬ë‚´ì‹ë‹¹",
        "ìˆœë‘ë¶€ì°Œê°œ", "ë™íƒœíƒ•", "ì•Œíƒ•", "ê°ìíƒ•", "ë¼ˆí•´ì¥êµ­", "ê³°íƒ•", "ì¡ì±„ë°¥", "ìœ ì‚°ìŠ¬", "ê¹í’ê¸°", "ê³ ì¶”ì¡ì±„",
        "íšŒë®ë°¥", "ë¬¼íšŒ", "ì—°ì–´ë®ë°¥", "ì¥ì–´ë®ë°¥", "ìƒ¤ë¸Œìƒ¤ë¸Œ", "í¸ë°±ì°œ", "ë§Œë‘êµ­", "ë–¡ë§Œë‘êµ­", "í† ìŠ¤íŠ¸", "ë² ì´ê¸€",
        "ì„œë¸Œì›¨ì´", "ë„ì‹œë½", "ì»µë°¥", "ë´‰êµ¬ìŠ¤ë°¥ë²„ê±°", "ì´ì‚­í† ìŠ¤íŠ¸", "ë§¥ë„ë‚ ë“œ", "ë²„ê±°í‚¹", "KFC", "ë§˜ìŠ¤í„°ì¹˜", "ë¡¯ë°ë¦¬ì•„",
        "ê³±ì°½", "ë§‰ì°½", "ëŒ€ì°½", "ì–‘ëŒ€ì°½", "ë‹­ë°œ", "ì˜¤ëŒë¼ˆ", "ê»ë°ê¸°", "ì‚¼ê²¹ì‚´", "ëª©ì‚´", "í•­ì •ì‚´"
    ];

    let lastTriggerTime = 0;
    const itemHeight = 100;

    function sendTrigger() {
        if(btn.disabled) return;
        
        let myNick = nickInput.value.trim();
        if (myNick === "") myNick = "ìµëª…";

        if (containsBadWord(myNick)) {
             alert("ğŸš« ë‹‰ë„¤ì„ì— ë¹„ì†ì–´ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.");
             return;
        }

        const winnerIndex = Math.floor(Math.random() * menus.length);
        const winnerMenu = menus[winnerIndex];

        // 1. ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸
        db.ref('slot_game_state').set({
            timestamp: Date.now(),
            winnerIndex: winnerIndex,
            sender: myNick
        });

        // 2. [ë­í‚¹ ì—…ë°ì´íŠ¸]
        db.ref(`menu_stats/${winnerMenu}`).transaction((current) => {
            return (current || 0) + 1;
        });
    }

    const gameRef = db.ref('slot_game_state');
    gameRef.on('value', (snapshot) => {
        const data = snapshot.val();
        if (data && data.timestamp > lastTriggerTime) {
            lastTriggerTime = data.timestamp;
            
            const sender = data.sender || 'UNKNOWN';
            appendMessage("SYSTEM", `>> Trigger signal from [${sender}]`);
            
            runSyncAnimation(data.winnerIndex);
        }
    });

    function runSyncAnimation(winnerIndex) {
        btn.disabled = true;
        btn.innerText = "SYNCING...";
        btn.style.background = "#555";
        
        resultDisplay.innerText = "DECRYPTING DATA...";
        resultDisplay.style.color = "#aaa";

        const winnerMenu = menus[winnerIndex];
        
        // âš¡ 6ì´ˆ íšŒì „
        const spinCount = 60; 
        const spinDuration = 6000; 

        reel.style.transition = 'none';
        reel.style.transform = 'translateY(0)';
        reel.innerHTML = '';

        for(let i=0; i<spinCount; i++) {
            const li = document.createElement('li');
            li.innerText = menus[Math.floor(Math.random() * menus.length)];
            reel.appendChild(li);
        }
        const winLi = document.createElement('li');
        winLi.innerText = winnerMenu;
        winLi.classList.add('highlight-text');
        reel.appendChild(winLi);

        void reel.offsetWidth;

        const targetY = -(spinCount * itemHeight);
        reel.style.transition = `transform ${spinDuration/1000}s cubic-bezier(0.1, 0.9, 0.2, 1)`;
        reel.style.transform = `translateY(${targetY}px)`;

        // ğŸŸ¢ 6ì´ˆ í›„ ê²°ê³¼ ë°œí‘œ -> 3ì´ˆ ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
        setTimeout(() => {
            btn.style.background = ""; 
            resultDisplay.innerHTML = `<span style="color:var(--gold)">${winnerMenu}</span> CONFIRMED`;

            // âœ¨ ì±„íŒ…ì°½ì— ê²°ê³¼ ì•Œë¦¼ ì¶”ê°€
            appendMessage("SYSTEM", `>>> ğŸ† ë‹¹ì²¨: [${winnerMenu}]`); 

            // ì¿¨íƒ€ì„ ì‹œì‘
            let countdown = 3;
            btn.innerText = `WAIT (${countdown})`;
            
            const countInterval = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    btn.innerText = `WAIT (${countdown})`;
                } else {
                    clearInterval(countInterval);
                    btn.disabled = false;
                    btn.innerText = "BROADCAST SPIN";
                }
            }, 1000);

        }, spinDuration);
    }
</script>
</body>
</html>